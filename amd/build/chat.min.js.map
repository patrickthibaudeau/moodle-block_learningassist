{"version":3,"file":"chat.min.js","sources":["../src/chat.js"],"sourcesContent":["import {get_string as getString} from 'core/str';\n// import Templates from 'core/templates';\nimport ajax from 'core/ajax';\n\n/* eslint-disable no-console */\nexport const sendMessage = async () => {\n  const input = document.getElementById('block-learningassist-chat-input');\n  const prompt = input.value;\n  if (prompt) {\n    const chatMessages = document.getElementById('chat-messages');\n    const loadingText = await getString('loading', 'block_learningassist');\n\n    const html = `<div class=\"chat-message human-message\">\n                        <div class=\"message-content\">${prompt}</div>\n                     </div>\n                    <div id=\"block-learningassist-delete-me\" class=\"chat-message bot-message\">\n                        <div class=\"message-content\">\n                        <i class=\"fa fa-spinner fa-pulse fa-3x fa-fw\"></i>\n                        <span class=\"sr-only\">${loadingText}</span></div>\n                     </div>`;\n    // Scroll down to the top of new message\n    chatMessages.innerHTML += html;\n    chatMessages.scrollTop = chatMessages.scrollHeight;\n    input.value = '';\n\n    const courseId = document.getElementById('block-learningassist-courseid').value;\n    const chatType = document.getElementById('block-learningassist-chat-type').value;\n    const chatId = document.getElementById('block-learningassist-chatid').value;\n\n    if (prompt) {\n      const response = await ajax.call([{\n        methodname: 'block_learningassist_chat',\n        args: {\n          courseid: courseId,\n          chattype: chatType,\n          prompt: prompt,\n          chatid: chatId\n        },\n      }]);\n      response[0].done((result) => {\n        const deleteMe = document.getElementById('block-learningassist-delete-me');\n        if (deleteMe) {\n          deleteMe.remove();\n        }\n        const bot_html = `<div class=\"chat-message bot-message\">\n                            <div class=\"message-content\">${result}</div>\n                         </div>`;\n        chatMessages.innerHTML += bot_html;\n        input.focus();\n      }).fail((error) => {\n        console.log(error);\n      });\n    }\n  }\n};\n\n\nwindow.addEventListener('beforeunload', () => {\n  const chatIdElement = document.getElementById('block-learningassist-chatid');\n  if (chatIdElement) {\n    const chatId = chatIdElement.value;\n    // Run ajax call to clear history\n    ajax.call([{\n      methodname: 'block_learningassist_clear_chat_history',\n      args: {\n        chatid: chatId\n      },\n    }]).then(() => {\n      console.log('Chat history cleared');\n    }).catch((error) => {\n      console.error('Error clearing chat history:', error);\n    });\n  }\n});\n\ndocument.getElementById('block-learningassist-chat-send-btn').addEventListener('click', sendMessage);\n\ndocument.getElementById('block-learningassist-chat-input').addEventListener('keydown', (e) => {\n  if (e.key === 'Enter') {\n    e.preventDefault();\n    sendMessage();\n  }\n});\n"],"names":["sendMessage","async","input","document","getElementById","prompt","value","chatMessages","loadingText","html","innerHTML","scrollTop","scrollHeight","courseId","chatType","chatId","ajax","call","methodname","args","courseid","chattype","chatid","done","result","deleteMe","remove","bot_html","focus","fail","error","console","log","window","addEventListener","chatIdElement","then","catch","e","key","preventDefault"],"mappings":"2PAKaA,YAAcC,gBACnBC,MAAQC,SAASC,eAAe,mCAChCC,OAASH,MAAMI,SACjBD,OAAQ,OACJE,aAAeJ,SAASC,eAAe,iBACvCI,kBAAoB,mBAAU,UAAW,wBAEzCC,8GAC6CJ,wUAKPG,0DAG5CD,aAAaG,WAAaD,KAC1BF,aAAaI,UAAYJ,aAAaK,aACtCV,MAAMI,MAAQ,SAERO,SAAWV,SAASC,eAAe,iCAAiCE,MACpEQ,SAAWX,SAASC,eAAe,kCAAkCE,MACrES,OAASZ,SAASC,eAAe,+BAA+BE,SAElED,OAAQ,QACaW,cAAKC,KAAK,CAAC,CAChCC,WAAY,4BACZC,KAAM,CACJC,SAAUP,SACVQ,SAAUP,SACVT,OAAQA,OACRiB,OAAQP,YAGH,GAAGQ,MAAMC,eACVC,SAAWtB,SAASC,eAAe,kCACrCqB,UACFA,SAASC,eAELC,oHAC6CH,kDAEnDjB,aAAaG,WAAaiB,SAC1BzB,MAAM0B,WACLC,MAAMC,QACPC,QAAQC,IAAIF,8CAOpBG,OAAOC,iBAAiB,gBAAgB,WAChCC,cAAgBhC,SAASC,eAAe,kCAC1C+B,cAAe,OACXpB,OAASoB,cAAc7B,oBAExBW,KAAK,CAAC,CACTC,WAAY,0CACZC,KAAM,CACJG,OAAQP,WAERqB,MAAK,KACPL,QAAQC,IAAI,2BACXK,OAAOP,QACRC,QAAQD,MAAM,+BAAgCA,cAKpD3B,SAASC,eAAe,sCAAsC8B,iBAAiB,QAASlC,aAExFG,SAASC,eAAe,mCAAmC8B,iBAAiB,WAAYI,IACxE,UAAVA,EAAEC,MACJD,EAAEE,iBACFxC"}